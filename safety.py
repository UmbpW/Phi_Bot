"""Safety-—Ñ–∏–ª—å—Ç—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è/—Å—É–∏—Ü–∏–¥–∞."""

import re

# –°–ª–æ–≤–∞/—Ñ—Ä–∞–∑—ã, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ —Ä–∏—Å–∫ (—Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π —Å–ø–∏—Å–æ–∫)
RISK_PATTERNS = [
    r"\b—É–±–∏—Ç—å\s+—Å–µ–±—è\b",
    r"\b–ø–æ–∫–æ–Ω—á–∏—Ç—å\s+—Å\s+—Å–æ–±–æ–π\b",
    r"\b—Å—É–∏—Ü–∏–¥\w*\b",
    r"\b—Å–∞–º–æ—É–±–∏–π—Å—Ç–≤\w*\b",
    r"\b–ø–æ–≤–µ—Å–∏—Ç—å—Å—è\b",
    r"\b–ø–µ—Ä–µ—Ä–µ–∑–∞—Ç—å\s+–≤–µ–Ω—ã\b",
    r"\b–ø–æ—Ä–µ–∑–∞—Ç—å\s+—Å–µ–±—è\b",
    r"\b–Ω–∞–≤—Ä–µ–¥–∏—Ç—å\s+—Å–µ–±–µ\b",
    r"\b–∫–æ–Ω—á–∏—Ç—å\s+–∂–∏–∑–Ω—å\b",
    r"\b—Å–≤–µ—Å—Ç–∏\s+—Å—á—ë—Ç—ã\b",
    r"\b–Ω–µ\s+—Ö–æ—á—É\s+–∂–∏—Ç—å\b",
    r"\b–ª—É—á—à–µ\s+—É–º–µ—Ä–µ—Ç—å\b",
    r"\b–≤—ã–±—Ä–æ—Å–∏—Ç—å—Å—è\b",
    r"\b–æ—Ç—Ä–∞–≤–∏—Ç—å—Å—è\b",
    r"\b–ø–æ—Ä–µ–∑—ã\b.*\b—Å–∞–º\b",
]

# Soft bridge: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ, –ø–æ—Ç–æ–º check, referral —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
SAFE_RESPONSE_BRIDGE = (
    "–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ —Ç–µ–±–µ —Å–µ–π—á–∞—Å —Ç—è–∂–µ–ª–æ.\n\n"
    "–ú–Ω–µ –≤–∞–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å ‚Äî —Ç—ã —Å–µ–π—á–∞—Å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?"
)
# –†–µ—Ñ–µ—Ä–∞–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∏—Å–∫–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏)
SAFE_RESPONSE_REFERRAL = (
    "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª.\n\n"
    "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–≥–æ–≤–æ—Ä–∏ —Å –∫–µ–º-—Ç–æ –µ—â—ë:\n"
    "üìû 8-800-2000-122 (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ)\n"
    "üí¨ fpond.ru"
)


def check_safety(text: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è/—Å—É–∏—Ü–∏–¥–∞.

    Returns:
        True –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–Ω—É–∂–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å),
        False –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω.
    """
    if not text or not text.strip():
        return False
    normalized = text.lower().strip()
    for pattern in RISK_PATTERNS:
        if re.search(pattern, normalized, re.IGNORECASE):
            return True
    return False


def get_safe_response() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º—è–≥–∫–∏–π safety bridge: –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ + check, –±–µ–∑ hotline —Å—Ä–∞–∑—É."""
    return SAFE_RESPONSE_BRIDGE
